(function(e,t){
    var n;
    var r = e(t);
    var i = {buttons:{button1: {text: "OK", danger: false, onclick: function(){
                    e.fallr.hide()
                }}},icon: "check",
                    content: "Hello",
                    position: "top",
                    closeKey: true,
                    closeOverlay: false,
                    useOverlay: true,
                    autoclose: false,
                    easingDuration: 1,
                    easingIn: "swing",
                    easingOut: "swing",
                    height: "auto",
                    width: "360px",
                    zIndex: 100,
                    bound: t,
                    afterHide: function(){
        }, afterShow: function() {
        }};
    var s = {hide: function(u, a) {
            if (typeof u === "function") {
                a = u;
                u = i
            }
            if (s.isActive()) {
                e("#fallr-wrapper").stop(true, true);
                var f = e("#fallr-wrapper");
                var l = f.css("position");
                var c = l === "fixed";
                var h = 0;
                switch (opts.position) {
                    case"bottom":
                    case"center":
                        h = (c ? r.height() : f.offset().top + f.outerHeight()) + 10;
                        break;
                    case"top":
                    default:
                        h = (c ? -1 * f.outerHeight() : f.offset().top - f.outerHeight()) - 10
                }
                f.animate({top: h, opacity: c ? 1 : 0}, opts.easingDuration || opts.duration, opts.easingOut, function() {
                    if (t.navigator.userAgent.match(/msie/i)) {
                        e("#fallr-overlay").css("display", "none")
                    } else {
                        e("#fallr-overlay").fadeOut("fast")
                    }
                    f.remove();
                    clearTimeout(n);
                    a = typeof a === "function" ? a : opts.afterHide;
                    a.call(t)
                });
                e(document).unbind("keydown", o.enterKeyHandler).unbind("keydown", o.closeKeyHandler).unbind("keydown", o.tabKeyHandler)
            }
        }, resize: function(n, r) {
            var i = e("#fallr-wrapper");
            var u = parseInt(n.width, 10);
            var a = parseInt(n.height, 10);
            var f = Math.abs(i.outerWidth() - u);
            var l = Math.abs(i.outerHeight() - a);
            if (s.isActive() && (f > 5 || l > 5)) {
                i.animate({width: u}, function() {
                    e(this).animate({height: a}, function() {
                        o.fixPos()
                    })
                });
                e("#fallr").animate({width: u - 94}, function() {
                    e(this).animate({height: a - 116}, function() {
                        if (typeof r === "function") {
                            r.call(t)
                        }
                    })
                })
            }
        }, show: function(u, a) {
            if (typeof u === "function") {
                a = u;
                u = i
            }
            if (s.isActive()) {
                e("body", "html").animate({scrollTop: e("#fallr").offset().top}, function() {
                    e.fallr.shake()
                });
                e.error("A message is still active")
            } else {
                opts = e.extend({}, i, u);
                e('<div id="fallr-wrapper"></div>').appendTo("body");
                opts.bound = e(opts.bound).length > 0 ? opts.bound : t;
                var f = e("#fallr-wrapper");
                var l = e("#fallr-overlay");
                var c = opts.bound === t;
                f.css({width: opts.width, height: opts.height, position: "absolute", top: "-9999px", left: "-9999px"}).html('<div id="fallr-icon"></div>' + '<div id="fallr"></div>' + '<div id="fallr-buttons"></div>').find("#fallr-icon").addClass("icon-" + opts.icon).end().find("#fallr").html(opts.content).css({height: opts.height == "auto" ? "auto" : f.height() - 116, width: f.width() - 94}).end().find("#fallr-buttons").html(function() {
                    var e = "";
                    for (var t in opts.buttons) {
                        if (opts.buttons.hasOwnProperty(t)) {
                            e = e + '<a href="#" class="fallr-button ' + (opts.buttons[t].danger ? "fallr-button-danger" : "") + '" id="fallr-button-' + t + '">' + opts.buttons[t].text + "</a>"
                        }
                    }
                    return e
                }()).find(".fallr-button").bind("click", function() {
                    var t = e(this).attr("id").substring(13);
                    if (typeof opts.buttons[t].onclick === "function" && opts.buttons[t].onclick != false) {
                        var n = e("#fallr");
                        opts.buttons[t].onclick.apply(n)
                    } else {
                        s.hide()
                    }
                    return false
                });
                var h = function(){
                    f.show();
                    var i, o;
                    var u = c ? (r.width() - f.outerWidth()) / 2 + r.scrollLeft() : (e(opts.bound).width() - f.outerWidth()) / 2 + e(opts.bound).offset().left;
                    var h = r.height() > f.height() && r.width() > f.width() && c ? "fixed" : "absolute";
                    var p = h === "fixed";
                    switch (opts.position) {
                        case"bottom":
                            i = c ? p ? r.height() : r.scrollTop() + r.height() : e(opts.bound).offset().top + e(opts.bound).outerHeight();
                            o = i - f.outerHeight();
                            break;
                        case"center":
                            i = c ? p ? -1 * f.outerHeight() : l.offset().top - f.outerHeight() : e(opts.bound).offset().top + e(opts.bound).height() / 2 - f.outerHeight();
                            o = i + f.outerHeight() + ((c ? r.height() : f.outerHeight() / 2) - f.outerHeight()) / 2;
                            break;
                        case"top":
                        default:
                            o = c ? p ? 0 : r.scrollTop() : e(opts.bound).offset().top;
                            i = o - f.outerHeight()
                    }
                    f.css({left: u, position: h, top: i, "z-index": opts.zIndex + 1}).animate({top: o}, opts.easingDuration, opts.easingIn, function() {
                        a = typeof a === "function" ? a : opts.afterShow;
                        a.call(t);
                        if (opts.autoclose) {
                            n = setTimeout(s.hide, opts.autoclose)
                        }
                    })
                };
                if (opts.useOverlay) {
                    if (t.navigator.userAgent.match(/msie [678]/)) {
                        l.css({display: "block", "z-index": opts.zIndex});
                        h()
                    } else {
                        l.css({"z-index": opts.zIndex}).fadeIn(h)
                    }
                } else {
                    h()
                }
                e(document).bind("keydown", o.enterKeyHandler).bind("keydown", o.closeKeyHandler).bind("keydown", o.tabKeyHandler);
                e("#fallr-buttons").children().eq(-1).bind("focus", function() {
                    e(this).bind("keydown", o.tabKeyHandler)
                });
                f.find(":input").bind("keydown", function(t) {
                    o.unbindKeyHandler();
                    if (t.keyCode === 13) {
                        e(".fallr-button").eq(0).trigger("click")
                    }
                })
            }
        }, set: function(e, n) {
            for (var r in e) {
                if (i.hasOwnProperty(r)) {
                    i[r] = e[r];
                    if (i && i[r]) {
                        i[r] = e[r]
                    }
                }
            }
            if (typeof n === "function") {
                n.call(t)
            }
        }, isActive: function() {
            return!!(e("#fallr-wrapper").length > 0)
        }, blink: function() {
            e("#fallr-wrapper").fadeOut(10, function() {
                e(this).fadeIn(10)
            })
        }, shake: function() {
            e("#fallr-wrapper").stop(true, true).animate({left: "+=20px"}, 50, function() {
                e(this).animate({left: "-=40px"}, 50, function() {
                    e(this).animate({left: "+=30px"}, 50, function() {
                        e(this).animate({left: "-=20px"}, 50, function() {
                            e(this).animate({left: "+=10px"}, 50)
                        })
                    })
                })
            })
        }}, o = {fixPos: function() {
            var t = e("#fallr-wrapper"), n = t.css("position");
            if (r.width() > t.outerWidth() && r.height() > t.outerHeight()) {
                var i = (r.width() - t.outerWidth()) / 2, s = r.height() - t.outerHeight();
                switch (opts.position) {
                    case"center":
                        s = s / 2;
                        break;
                    case"bottom":
                        break;
                    default:
                        s = 0
                }
                if (n == "fixed") {
                    t.animate({left: i}, function() {
                        e(this).animate({top: s})
                    })
                } else {
                    t.css({position: "fixed", left: i, top: s})
                }
            } else {
                var i = (r.width() - t.outerWidth()) / 2 + r.scrollLeft();
                var s = r.scrollTop();
                if (n != "fixed") {
                    t.animate({left: i}, function() {
                        e(this).animate({top: s})
                    })
                } else {
                    t.css({position: "absolute", top: s, left: i > 0 ? i : 0})
                }
            }
        }, enterKeyHandler: function(t) {
            if (t.keyCode === 13) {
                e("#fallr-buttons").children().eq(0).focus();
                o.unbindKeyHandler()
            }
        }, tabKeyHandler: function(t) {
            if (t.keyCode === 9) {
                e("#fallr-wrapper").find(":input, .fallr-button").eq(0).focus();
                o.unbindKeyHandler();
                t.preventDefault()
            }
        }, closeKeyHandler: function(e) {
            if (e.keyCode === 27 && opts.closeKey) {
                s.hide()
            }
        }, unbindKeyHandler: function() {
            e(document).unbind("keydown", o.enterKeyHandler).unbind("keydown", o.tabKeyHandler)
        }};
    e(document).ready(function(){
        e("body").append('<div id="fallr-overlay"></div>');
        e("#fallr-overlay").bind("click", function() {
            if (opts.closeOverlay) {
                s.hide()
            } else {
                s.blink()
            }
        })
    });
    e(t).resize(function() {
        if (s.isActive() && opts.bound === t) {
            o.fixPos()
        }
    });
    var u = function() {
    };
    u.prototype = s;
    e.fallr = new u
})(jQuery, window);
